import sys
import bson.objectid
import config.global_configuration as global_conf
import database.client


def main(*args):
    """
    Benchmark a particular trial result with a 
    This represents a basic task.
    Scripts to run this will be autogenerated by the job system
    The first argument is the id of the trial to benchmark, and the second argument is the id of the benchmark
    :return: 
    """
    if len(args) >= 2:
        trial_id = bson.objectid.ObjectId(args[0])
        benchmark_id = bson.objectid.ObjectId(args[1])

        config = global_conf.load_global_config('config.yml')
        db_client = database.client.DatabaseClient(config=config)

        s_trial = db_client.trials_collection.find_one({'_id': trial_id})
        trial_result = db_client.deserialize_entity(s_trial)

        s_benchmark = db_client.benchmarks_collection.find_one({'_id': benchmark_id})
        benchmark = db_client.deserialize_entity(s_benchmark)

        if benchmark.is_trial_appropriate(trial_result):
            benchmark_result = benchmark.benchmark_results(trial_result)
            db_client.results_collection.insert(benchmark_result.serialize())


if __name__ == '__main__':
    main(*sys.argv[1:])
